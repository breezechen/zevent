  A library & simple echo server,base on the fast and robust web server framework : apache httpd ,
  epoll for linux; kqueue for bsd; poll for any.

  Q: what & why?

  A:
  1, 提供开发服务器用动态库和一个echo示例.
  1，抽取改造apache httpd的核心通信框架使其用于通用开发，易于分析apache的服务器源码，学习其设计思路。
  2, 演示多进程，线程池，同步策略（锁，条件变量等），管道等等众多技术在后端服务器开发中的综合应用。

  重点应用：
  －－多进程+线程池使用epoll 的事件处理设计
  －－记分板机制的使用
  －－apr(apache runtime library)内存池的使用
  －－apache中钩子(hooks)的设计及应用，钩子的设计使apache可以灵活开发各种扩展模块，在这里
  演示其使用方法。
  －－buckets and brigade的使用，结合内存池简洁高效的处理服务器中需要缓冲处理的各种
  数据包括（memory,file,socket,pipe)
  －－构建工具cmake的使用

  编译安装:
  ======服务器使用cmake构建，请首先安装========
  ubuntu & debian 下：

  $apt-get install cmake

  该程序依赖于apr和apr-util,如果你尚未安装请执行如下安装:
  ======安装apr========
  $cd common
  $tar xzvf apr-1.3.2.tar.gz 
  $cd apr-1.3.2/
  $./configure
  $make install
  =====安装apr-util=====
  $cd common
  $tar xzvf apr-util-1.3.2.tar.gz
  $cd apr-util-1.3.2/
  $./configure --with-apr=/usr/local/apr/
  $make install
  =====最后一步=========
  $./build.sh

  安装后的程序和动态库在当前目录usb/bin下

  配置说明：

  #config.ini
  [network]
  port = 192.168.21.9:8889
  protocol = protocol
  [mpm_event]
  StartServers = 5
  ServerLimit = 25
  MinSpareThreads = 50
  MaxSpareThreads = 1000
  ThreadLimit = 200
  ThreadsPerChild = 100
  MaxRequestsPerChild = 0 
  [misc]
  logfile = log.txt

      服务器使用了多进程，每个进程又生成多个线程，以获得基于进程服务器的稳定性.
  服务器的工作原理是，由主控制进程生成“StartServers”个子进程，每个子进程中包含固定的ThreadsPerChild 线程数，
  各个线程独立地处理请求。MinSpareThreads和MaxSpareThreads设置了最少和最多的空闲线程数.

  　　ThreadsPerChild是与性能相关最密切的指令。ThreadsPerChild的最大缺省值是64，如果负载较大，64也是不够的。
  这时要显式使用 ThreadLimit指令，它的最大缺省值是20000.

     #define DEFAULT_THREAD_LIMIT 64
     #define MAX_THREAD_LIMIT 20000

  　　这两行对应着ThreadsPerChild和ThreadLimit的限制数。最好在configure之前就把64改成所希望的值。注意，不要把这两个值
  设得太高，超过系统的处理能力.

  　  如果负载很大，现有的子进程数不能满足时，控制进程会派生新的子进程。默认最大的子进程总数是16，
   加大时也需要显式声明ServerLimit（最大值是 20000）。

      系统采用的是事件触发回调机制，工作线程是否可尽快回归到线程池由使用者决定，处理得当就会得到
    很强的并发量和吞吐能力,可参加服务器中的处理方法。

     #define DEFAULT_SERVER_LIMIT 16
     #define MAX_SERVER_LIMIT 20000


=======================================bug report==================================================

         (__)                                                                
         (oo) 
   /------\/ 
  / |    ||   
 *  /\---/\ 
    ~~   ~~   
msn:chinasihai@gmail.com
mail:chinasihai@gmail.com
zhoubug
2008-07-30 11:17:47
 
